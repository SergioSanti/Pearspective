<link rel="stylesheet" href="../navbar.css">
<!-- Navbar -->
<div class="navbar">
  <!-- Círculo do usuário e menu dropdown -->
  <div class="user-circle-container">
    <div class="user-circle" id="userCircle"></div>
    <div class="user-name" id="userNameDisplay"></div>
    <div class="user-menu">
      <ul>
        <li><a href="../simulador/simulador.html">Simulador</a></li>
        <li><a href="../biblioteca/biblioteca.html">Cursos</a></li>
        <li><a href="../recomendacoes.html">Recomendações</a></li>
        <li><a href="../Page_inicial/relatorios.html">Relatórios</a></li>
        <li class="divider"></li>
        <li><a href="../historico/historico.html">Meus Certificados</a></li>
        <li><a href="../perfil/perfil.html">Meu Perfil</a></li>
        <li class="divider"></li>
        <li class="photo-upload">
          <label class="photo-upload-label">
            Alterar Foto
            <input type="file" id="photoUpload" accept="image/*">
          </label>
        </li>
        <li class="divider"></li>
        <li><a href="#" id="logoutButton">Logoff</a></li>
      </ul>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Função para obter a inicial do usuário
  function getUserInitial() {
    const userName = localStorage.getItem('userName') || 'U';
    return userName.charAt(0).toUpperCase();
  }

  // Função para atualizar o círculo do usuário
  function updateUserCircle() {
    const userCircle = document.getElementById('userCircle');
    const userPhoto = localStorage.getItem('userPhoto');
    const userName = localStorage.getItem('userName') || '';
    const userNameDisplay = document.getElementById('userNameDisplay');
    console.log('[NAVBAR] userName lido do localStorage:', userName);
    
    if (userPhoto) {
      userCircle.innerHTML = `<img src="${userPhoto}" alt="Foto do usuário">`;
    } else {
      userCircle.textContent = getUserInitial();
    }
    userNameDisplay.textContent = userName;
  }

  // Função para lidar com o upload de foto
  document.getElementById('photoUpload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        localStorage.setItem('userPhoto', e.target.result);
        updateUserCircle();
      };
      reader.readAsDataURL(file);
    }
  });

  // Função para lidar com o logout
  document.getElementById('logoutButton').addEventListener('click', function(e) {
    e.preventDefault();
    localStorage.removeItem('userName');
    localStorage.removeItem('userPhoto');
    console.log('[NAVBAR] Logoff: localStorage após remoção:', localStorage.getItem('userName'));
    window.location.href = '/login.html';
  });

  // Atualiza o círculo do usuário ao carregar a página
  updateUserCircle();
});
</script>
